# ðŸš€ Replit Deployment Guide for Letters App

**Complete, production-ready guide to deploy Letters app on Replit**

---

## ðŸ“‹ Table of Contents

- [Prerequisites](#-prerequisites)
- [Quick Start](#-quick-start)
- [Detailed Setup](#-detailed-setup)
- [Environment Variables](#-environment-variables)
- [Database Configuration](#-database-configuration)
- [Production Deployment](#-production-deployment)
- [Troubleshooting](#-troubleshooting)
- [Security](#-security)
- [Monitoring](#-monitoring)

---

## âœ… Prerequisites

Before starting, ensure you have:

- [ ] **Replit Account** - [Sign up free](https://replit.com/signup)
- [ ] **GitHub Repository** (optional) - For version control
- [ ] **Basic Terminal Knowledge** - For running commands
- [ ] **5-10 Minutes** - For initial setup

---

## ðŸš€ Quick Start

### Method 1: Automated Setup (Recommended)

1. **Import to Replit**
   - Go to [Replit](https://replit.com)
   - Click **"Create Repl"**
   - Select **"Import from GitHub"**
   - Enter your repository URL
   - Click **"Import"**

2. **Run Setup Script**
   ```bash
   bash setup-replit.sh
   ```
   This will:
   - âœ… Check Node.js version
   - âœ… Install dependencies
   - âœ… Configure environment variables
   - âœ… Setup Prisma database
   - âœ… Build the project

3. **Configure Secrets**
   - Click the **ðŸ”’ Secrets** tab
   - Add required variables (see [Environment Variables](#-environment-variables))

4. **Start the App**
   - Click **"Run"** button
   - Or run: `npm run dev`

5. **Access Your App**
   - URL: `https://your-repl-name.yourusername.repl.co`

### Method 2: Manual Setup

If you prefer manual setup, see [Detailed Setup](#-detailed-setup) section.

---

## ðŸ“– Detailed Setup

### Step 1: Create Repl

1. Go to [Replit](https://replit.com)
2. Click **"Create Repl"**
3. Choose **"Node.js"** template
4. Name it `letters-app`
5. Click **"Create Repl"**

### Step 2: Upload Project Files

**Option A: From GitHub**
```bash
git clone https://github.com/yourusername/letters-app.git
cd letters-app
# Copy all files to Replit
```

**Option B: Manual Upload**
- Use Replit's file upload feature
- Upload all project files maintaining directory structure

### Step 3: Install Dependencies

```bash
npm install
```

**If you encounter peer dependency warnings:**
```bash
npm install --legacy-peer-deps
```

### Step 4: Configure Environment

```bash
# Copy example env file
cp .env.example .env.local

# Or create manually
cat > .env.local << EOF
DATABASE_URL="file:./dev.db"
NEXTAUTH_URL="https://your-repl.replit.dev"
NEXTAUTH_SECRET="your-secret-here"
EOF
```

### Step 5: Setup Database

```bash
# Generate Prisma Client
npx prisma generate

# Run migrations
npx prisma migrate dev --name init
```

### Step 6: Build & Test

```bash
# Build the project
npm run build

# Start development server
npm run dev
```

---

## ðŸ” Environment Variables

### Required Variables

These **must** be set in Replit Secrets (ðŸ”’ tab):

| Variable | Description | Example | How to Get |
|----------|-------------|---------|------------|
| `DATABASE_URL` | Database connection string | `file:./dev.db` | See [Database Config](#-database-configuration) |
| `NEXTAUTH_URL` | Your app's public URL | `https://letters-app.user.repl.co` | Auto-detected by script |
| `NEXTAUTH_SECRET` | JWT signing secret | Random 32-byte string | Auto-generated by script |

### Optional Variables

| Variable | Description | When Needed |
|----------|-------------|-------------|
| `RESEND_API_KEY` | Resend email API key | For sending emails |
| `GMAIL_CLIENT_ID` | Gmail OAuth client ID | For Gmail integration |
| `GMAIL_CLIENT_SECRET` | Gmail OAuth secret | For Gmail integration |
| `GOOGLE_CLIENT_ID` | Google OAuth client ID | For Google sign-in |
| `GOOGLE_CLIENT_SECRET` | Google OAuth secret | For Google sign-in |
| `BLOB_READ_WRITE_TOKEN` | File storage token | For file uploads |
| `UPSTASH_REDIS_REST_URL` | Redis URL | For rate limiting |
| `UPSTASH_REDIS_REST_TOKEN` | Redis token | For rate limiting |

### Setting Secrets in Replit

1. Click the **ðŸ”’ Secrets** tab (lock icon in sidebar)
2. Click **"New secret"**
3. Enter:
   - **Key**: `DATABASE_URL`
   - **Value**: `file:./dev.db`
4. Click **"Add secret"**
5. Repeat for all required variables

**Important Notes:**
- Secrets override `.env.local` values
- Secrets are encrypted and secure
- Never commit secrets to git
- Use Secrets for production, `.env.local` for development

### Generating NEXTAUTH_SECRET

**In Replit Shell:**
```bash
# Using OpenSSL (if available)
openssl rand -base64 32

# Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

---

## ðŸ’¾ Database Configuration

### Option 1: SQLite (Development)

**Best for**: Development, testing, small projects

**Setup:**
```bash
# In Secrets or .env.local
DATABASE_URL="file:./dev.db"
```

**Pros:**
- âœ… Zero configuration
- âœ… No external services
- âœ… Fast for small datasets
- âœ… Perfect for development

**Cons:**
- âŒ Not ideal for production
- âŒ Limited scalability
- âŒ No concurrent writes

**Migration:**
```bash
npx prisma migrate dev --name init
```

### Option 2: Replit Database

**Best for**: Replit-native projects, simple production

**Setup:**
1. Enable Replit Database in your Repl
2. Get connection string from Replit dashboard
3. Set as `DATABASE_URL` in Secrets

**Pros:**
- âœ… Built into Replit
- âœ… Persistent storage
- âœ… Free tier available
- âœ… Easy to use

**Cons:**
- âŒ Replit-specific
- âŒ Limited features

### Option 3: External PostgreSQL (Production)

**Best for**: Production, scalability, reliability

**Recommended Providers:**

#### Supabase (Recommended)
1. Sign up at [supabase.com](https://supabase.com)
2. Create new project
3. Go to Settings â†’ Database
4. Copy connection string
5. Format: `postgresql://postgres:[PASSWORD]@[HOST]:5432/postgres`

#### Neon
1. Sign up at [neon.tech](https://neon.tech)
2. Create database
3. Copy connection string
4. Use as `DATABASE_URL`

#### Railway
1. Sign up at [railway.app](https://railway.app)
2. Create PostgreSQL service
3. Copy connection string
4. Use as `DATABASE_URL`

**Setup Steps:**
1. Create PostgreSQL database on provider
2. Get connection string
3. Add to Replit Secrets as `DATABASE_URL`
4. Update Prisma schema (if needed):
   ```prisma
   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }
   ```
5. Run migrations:
   ```bash
   npx prisma migrate deploy
   ```

**Pros:**
- âœ… Production-ready
- âœ… Highly scalable
- âœ… ACID compliant
- âœ… Concurrent access
- âœ… Backup/restore

**Cons:**
- âŒ Requires external service
- âŒ May have costs at scale

---

## ðŸ— Production Deployment

### Build Configuration

Ensure your `package.json` has:

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  }
}
```

### Deployment Steps

1. **Enable Always On**
   - In `.replit` file: `alwaysOn = true`
   - Or in Replit settings

2. **Set Deploy Command**
   - Already configured in `.replit`:
   ```toml
   [deploy]
   run = ["sh", "-c", "npm run build && npm start"]
   ```

3. **Deploy**
   - Click **"Deploy"** button in Replit
   - Or push to main branch (if connected to GitHub)

4. **Verify**
   - Check logs for errors
   - Visit your app URL
   - Test critical features

### Production Checklist

- [ ] All environment variables set in Secrets
- [ ] Database migrations run successfully
- [ ] Build completes without errors
- [ ] App starts and responds to requests
- [ ] Health check endpoint works (`/api/health`)
- [ ] Authentication works
- [ ] Database connections stable
- [ ] Error logging configured
- [ ] Monitoring set up (optional)

---

## ðŸ›  Troubleshooting

### Issue: "Port already in use"

**Solution:**
Replit automatically handles ports. If issues occur:
```bash
# Check what's using the port
lsof -i :3000

# Or use a different port
export PORT=3001
npm run dev
```

### Issue: "Database connection failed"

**Symptoms:**
- `PrismaClientInitializationError`
- `Can't reach database server`

**Solutions:**
1. **Check DATABASE_URL**
   ```bash
   echo $DATABASE_URL
   # Should show your database URL
   ```

2. **Verify SQLite file exists**
   ```bash
   ls -la prisma/dev.db
   # Should show the database file
   ```

3. **Check file permissions**
   ```bash
   chmod 666 prisma/dev.db
   ```

4. **For PostgreSQL:**
   - Verify connection string format
   - Check if database is accessible
   - Ensure IP whitelist includes Replit

### Issue: "Build fails"

**Symptoms:**
- `npm run build` fails
- TypeScript errors
- Module not found errors

**Solutions:**
```bash
# Clear cache and rebuild
rm -rf .next node_modules
npm install
npm run build

# Check for TypeScript errors
npx tsc --noEmit

# Check for linting errors
npm run lint
```

### Issue: "Prisma client not found"

**Symptoms:**
- `Cannot find module '@prisma/client'`
- `PrismaClient is not a constructor`

**Solutions:**
```bash
# Regenerate Prisma Client
npx prisma generate

# If still issues, clean and reinstall
rm -rf node_modules/.prisma
npm install
npx prisma generate
```

### Issue: "Environment variables not loading"

**Symptoms:**
- `process.env.VARIABLE` is undefined
- Variables not accessible in code

**Solutions:**
1. **Check Secrets tab**
   - Ensure variables are in Secrets (not just `.env.local`)
   - Variable names must match exactly (case-sensitive)

2. **Restart Repl**
   - Stop the app
   - Start again
   - Secrets are loaded on startup

3. **Verify in code**
   ```typescript
   // Add temporary logging
   console.log('DATABASE_URL:', process.env.DATABASE_URL);
   ```

### Issue: "Module not found"

**Symptoms:**
- `Cannot find module 'xyz'`
- Import errors

**Solutions:**
```bash
# Reinstall dependencies
rm -rf node_modules package-lock.json
npm install

# Check if package is in package.json
npm list [package-name]
```

### Issue: "Next.js build errors"

**Solutions:**
```bash
# Clear Next.js cache
rm -rf .next

# Rebuild
npm run build

# Check for specific errors in build output
```

---

## ðŸ”’ Security

### Security Checklist

- [ ] **Secrets Management**
  - âœ… All secrets in Replit Secrets (not in code)
  - âœ… `.env.local` in `.gitignore`
  - âœ… No secrets committed to git

- [ ] **Authentication**
  - âœ… Strong `NEXTAUTH_SECRET` (32+ bytes)
  - âœ… Secure password hashing (bcrypt)
  - âœ… Session management configured

- [ ] **Database**
  - âœ… Database credentials secure
  - âœ… Connection strings encrypted
  - âœ… Regular backups (if production)

- [ ] **API Security**
  - âœ… Input validation (Zod)
  - âœ… Rate limiting (if needed)
  - âœ… CORS configured
  - âœ… HTTPS enabled (automatic on Replit)

### Best Practices

1. **Never commit secrets**
   ```bash
   # Ensure .env.local is in .gitignore
   echo ".env.local" >> .gitignore
   ```

2. **Rotate secrets regularly**
   - Change `NEXTAUTH_SECRET` periodically
   - Update database passwords

3. **Use strong secrets**
   ```bash
   # Generate strong secret
   openssl rand -base64 32
   ```

4. **Monitor for vulnerabilities**
   ```bash
   # Check for vulnerable packages
   npm audit
   npm audit fix
   ```

---

## ðŸ“Š Monitoring

### Health Check Endpoint

Create `src/app/api/health/route.ts`:

```typescript
import { NextResponse } from "next/server";
import { prisma } from "@/lib/prisma";

export async function GET() {
  try {
    // Check database connection
    await prisma.$queryRaw`SELECT 1`;
    
    return NextResponse.json({
      status: "ok",
      timestamp: new Date().toISOString(),
      environment: process.env.NODE_ENV,
      database: "connected",
    });
  } catch (error) {
    return NextResponse.json(
      {
        status: "error",
        timestamp: new Date().toISOString(),
        error: error instanceof Error ? error.message : "Unknown error",
      },
      { status: 500 }
    );
  }
}
```

Access at: `https://your-repl.replit.dev/api/health`

### Viewing Logs

1. **Replit Console**
   - Check shell output
   - View error messages
   - Monitor requests

2. **Application Logs**
   ```typescript
   // Add logging
   console.log('App started:', new Date());
   ```

3. **Error Tracking** (Optional)
   ```bash
   npm install @sentry/nextjs
   ```
   Configure Sentry for production error tracking

---

## ðŸ“š Additional Resources

- [Replit Documentation](https://docs.replit.com)
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [Prisma Deployment](https://www.prisma.io/docs/guides/deployment)
- [NextAuth.js Deployment](https://next-auth.js.org/configuration/options)
- [Replit Community](https://replit.com/talk)

---

## ðŸ†˜ Support

If you encounter issues:

1. **Check Troubleshooting** section above
2. **Review Replit logs** in console
3. **Check GitHub Issues** (if applicable)
4. **Ask in Replit Community**
5. **Review Documentation** links above

---

**Last Updated**: November 2024  
**Status**: âœ… Production Ready  
**Maintained by**: Letters App Team

